generator client {
	provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
	provider = "postgresql"
}

enum Category {
	strength
	cardio
	flexibility
	mobility
	hiit
}

enum TargetGender {
	male
	female
	both
}

enum DifficultyLevel {
	beginner
	intermediate
	advanced
}

model Workout {
	id                 Int                @id @default(autoincrement())
	name               String
	category           Category
	targetGender       TargetGender?
	difficultyLevel    DifficultyLevel
	targetMuscles      String[]
	equipmentNeeded    String[]
	description        String?
	properForm         String?
	commonMistakes     String?
	setsRecommended    Int?
	repsRecommended    String?
	restTimeSeconds    Int?
	naijaContext       String?
	createdAt          DateTime           @default(now())

	// relations for alternatives
	alternativesFrom   ExerciseAlternative[] @relation("original")
	alternativesTo     ExerciseAlternative[] @relation("alternative")

	@@map("workouts")
}

model ExerciseAlternative {
	id                    Int     @id @default(autoincrement())
	originalExerciseId    Int
	alternativeExerciseId Int
	reason                String?

	originalExercise      Workout @relation("original", fields: [originalExerciseId], references: [id], onDelete: Cascade)
	alternativeExercise   Workout @relation("alternative", fields: [alternativeExerciseId], references: [id], onDelete: Cascade)

	@@map("exercise_alternatives")
}

model FormGuide {
  id                    Int       @id @default(autoincrement())
  exerciseId            Int
  stanceDescription     String?
  gripDescription       String?
  movementPattern       String?
  breathingTechnique    String?
  videoUrl              String?
  imageUrl              String?
  safetyTips            String[]  
  commonInjuriesToAvoid String[]  
  createdAt             DateTime  @default(now())

  @@map("form_guides")
}

enum FoodCategory {
  protein
  carbs
  vegetables
  fruits
  snacks
  beverages
  swallow
}

enum Availability {
  common
  seasonal
  regional
}

enum MealGoal {
  weight_loss
  muscle_gain
  maintenance
  endurance
  strength
}

enum MealType {
  breakfast
  lunch
  dinner
  snack
}

model NigerianFood {
  id                 Int                @id @default(autoincrement())
  name               String
  localName          String?
  category           FoodCategory
  caloriesPer100g    Decimal            @db.Decimal(6, 2)
  proteinG           Decimal            @db.Decimal(5, 2)
  carbsG             Decimal            @db.Decimal(5, 2)
  fatsG              Decimal            @db.Decimal(5, 2)
  fiberG             Decimal            @db.Decimal(5, 2)
  isBudgetFriendly   Boolean
  availability       Availability
  preparationTips    String?
  createdAt          DateTime           @default(now())

  // Relations for alternatives
  alternativesFrom   FoodAlternative[]  @relation("original")
  alternativesTo     FoodAlternative[]  @relation("alternative")

  // Relations to meal plans
  mealPlanItems      MealPlanItem[]

  @@map("nigerian_foods")
}

model FoodAlternative {
  id                 Int                @id @default(autoincrement())
  originalFoodId     Int
  alternativeFoodId  Int
  reason             String?            // 'lower_calorie', 'higher_protein', 'budget', 'healthier'
  notes              String?

  originalFood       NigerianFood       @relation("original", fields: [originalFoodId], references: [id], onDelete: Cascade)
  alternativeFood    NigerianFood       @relation("alternative", fields: [alternativeFoodId], references: [id], onDelete: Cascade)

  @@map("food_alternatives")
}

model MealPlan {
  id                 Int                @id @default(autoincrement())
  name               String
  goal               MealGoal
  targetGender       TargetGender
  dailyCalories      Int?
  totalProteinG      Decimal?           @db.Decimal(6, 2)
  totalCarbsG        Decimal?           @db.Decimal(6, 2)
  totalFatsG         Decimal?           @db.Decimal(6, 2)
  naijaContext       String?
  createdAt          DateTime           @default(now())

  // Meals in this plan
  meals              Meal[]

  @@map("meal_plans")
}

model Meal {
  id                 Int                @id @default(autoincrement())
  mealPlanId         Int
  mealType           MealType
  totalCalories      Int?
  totalProteinG      Decimal?           @db.Decimal(6, 2)
  totalCarbsG        Decimal?           @db.Decimal(6, 2)
  totalFatsG         Decimal?           @db.Decimal(6, 2)

  // Foods in this meal
  mealPlanItems      MealPlanItem[]
  mealPlan           MealPlan           @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)

  @@map("meals")
}

model MealPlanItem {
  id                 Int                @id @default(autoincrement())
  mealId             Int
  foodId             Int
  portion            String             // e.g., "1 cup", "100g", "2 pieces"
  calories           Int?
  proteinG           Decimal?           @db.Decimal(5, 2)
  carbsG             Decimal?           @db.Decimal(5, 2)
  fatsG              Decimal?           @db.Decimal(5, 2)

  food               NigerianFood       @relation(fields: [foodId], references: [id], onDelete: Cascade)
  meal               Meal               @relation(fields: [mealId], references: [id], onDelete: Cascade)

  @@map("meal_plan_items")
}

model WorkoutLog {
  id          Int      @id @default(autoincrement())
  userId      String   @map("user_id")
  workoutId   Int      @map("workout_id")
  workoutName String   @map("workout_name")
  sets        Int
  reps        Int
  weightKg    Float?   @map("weight_kg")
  notes       String?  @db.Text
  completedAt DateTime @default(now()) @map("completed_at")
  
  user        User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
  
  @@index([userId])
  @@index([completedAt])
  @@map("workout_logs")
}

model User {
  id            Int            @id @default(autoincrement())
  userId        String         @unique @map("user_id")
  gender        String?
  fitnessLevel  String?        @map("fitness_level")
  age           Int?
  weightKg      Float?         @map("weight_kg")
  heightCm      Float?         @map("height_cm")
  goals         String[]       @default([])
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  
  conversations Conversation[]
  workoutLogs   WorkoutLog[]
  
  @@map("users")
}

model Conversation {
  id        Int       @id @default(autoincrement())
  userId    String    @map("user_id")
  sessionId String    @unique @map("session_id")
  createdAt DateTime  @default(now()) @map("created_at")
  
  user      User      @relation(fields: [userId], references: [userId], onDelete: Cascade)
  messages  Message[]
  
  @@index([userId])
  @@map("conversations")
}

enum MessageRole {
  USER
  ASSISTANT
  SYSTEM
}

model Message {
  id             Int          @id @default(autoincrement())
  conversationId Int          @map("conversation_id")
  role           MessageRole
  content        String       @db.Text
  createdAt      DateTime     @default(now()) @map("created_at")
  
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  @@index([conversationId])
  @@map("messages")
}